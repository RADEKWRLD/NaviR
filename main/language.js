// 语言配置
export const translations = {
    'zh-CN': {
        'settings.title': '设置',
        'settings.theme': '主题',
        'settings.time': '时间显示',
        'settings.time.24h': '24小时制',
        'settings.time.seconds': '显示秒数',
        'settings.time.blink': '分隔符闪烁',
        'settings.navigation': '导航设置',
        'settings.navigation.reset': '重置快捷方式',
        'settings.language': '语言',
        'settings.background': '背景透明度',
        'settings.background.opacity': '透明度',
        'settings.background.opacity.0': '0%',
        'settings.background.opacity.10': '10%',
        'settings.background.opacity.20': '20%',
        'settings.background.opacity.30': '30%',
        'settings.shortcut.newtab': '新标签页打开快捷方式',
        'settings.shortcut.newtab.desc': '开启后，点击快捷方式将在新标签页打开，否则在本页面跳转',
        'settings.theme.default': '默认主题',
        'settings.theme.custom': '自定义主题',
        'settings.theme.gradient': '渐变色',
        'settings.theme.save': '保存主题',
        'settings.theme.saved': '已保存',
        'search.placeholder': '请输入搜索内容...',
        'search.engines.google': 'Google',
        'search.engines.bing': 'Bing',
        'search.engines.baidu': '百度',
        'search.engines.bingcn': '必应中国',
        'search.engines.github': 'GitHub',
        'search.engines.zhihu': '知乎',
        'search.engines.bilibili': '哔哩哔哩',
        'shortcut.add': '添加快捷方式',
        'shortcut.add.title': '添加网站捷径',
        'shortcut.add.url': '网址',
        'shortcut.add.name': '标题',
        'shortcut.add.auto': '- 留空即自动获取',
        'shortcut.add.cancel': '取消',
        'shortcut.add.confirm': '添加',
        'shortcut.reset.title': '确认重置',
        'shortcut.reset.message': '确定要重置所有快捷方式吗？这将删除所有自定义的快捷方式。',
        'shortcut.reset.cancel': '取消',
        'shortcut.reset.confirm': '确定重置',
        'shortcut.delete.title': '确认删除',
        'shortcut.delete.message': '确定要删除这个快捷方式吗？',
        'shortcut.delete.cancel': '取消',
        'shortcut.delete.confirm': '确定删除',
        'theme.pink': '粉色',
        'theme.deep-ocean': '深海',
        'theme.forest': '森林',
        'theme.sunset': '日落',
        'theme.neon': '霓虹',
        'theme.royal': '皇家',
        'theme.desert': '沙漠',
        'theme.aurora': '极光',
        'theme.cherry': '樱花',
        'theme.emerald': '翡翠',
        'theme.dark-night': '暗夜',
        'theme.pure-white': '纯白',
        'theme.cyberpunk': '赛博朋克',
        'theme.pastel': '柔和',
        'theme.midnight': '午夜',
        'theme.lavender': '薰衣草',
        'theme.ocean': '海洋',
        'theme.autumn': '秋季',
        'theme.mint': '薄荷',
        'theme.galaxy': '银河',
        'theme.black-yellow': '黑金',
        'theme.blue-yellow': '蓝金',
        'theme.orange-red': '橙红',
        'theme.black-blue': '黑蓝',
        'theme.purple-gold': '紫金',
        'theme.emerald-gold': '翠金',
        'theme.ruby-silver': '红银',
        'theme.jade-purple': '翠紫',
        'theme.crimson-gold': '绯金',
        'theme.azure-rose': '蓝粉',
        'shortcut.add.fetching': '正在获取...',
        'shortcut.add.fetch_failed': '获取失败',
        'login.title': '账号登录',
        'login.tab.login': '登录',
        'login.tab.register': '注册',
        'login.tab.forgot': '忘记密码',
        'login.email.placeholder': '邮箱',
        'login.password.placeholder': '密码',
        'login.button': '登录',
        'login.user.logout': '退出登录',
        'register.email.placeholder': '邮箱',
        'register.password.placeholder': '密码',
        'register.confirm.placeholder': '确认密码',
        'register.button': '注册',
        'forgot.email.placeholder': '邮箱',
        'forgot.button': '重置密码',
        'login.message.success': '登录成功',
        'login.message.error': '登录失败',
        'register.message.success': '注册成功',
        'register.message.error': '注册失败',
        'forgot.message.success': '重置密码邮件已发送',
        'forgot.message.error': '重置密码失败',
        'forgot.password.placeholder': '新密码',
        'forgot.confirm.placeholder': '确认新密码',
        'register.username.placeholder': '用户名',
        'login.status.not_logged_in': '未登录'
    },
    'en-US': {
        'settings.title': 'Settings',
        'settings.theme': 'Theme',
        'settings.time': 'Time Display',
        'settings.time.24h': '24-hour Format',
        'settings.time.seconds': 'Show Seconds',
        'settings.time.blink': 'Blink Separator',
        'settings.navigation': 'Navigation Settings',
        'settings.navigation.reset': 'Reset Shortcuts',
        'settings.language': 'Language',
        'settings.background': 'Background Opacity',
        'settings.background.opacity': 'Opacity',
        'settings.background.opacity.0': '0%',
        'settings.background.opacity.10': '10%',
        'settings.background.opacity.20': '20%',
        'settings.background.opacity.30': '30%',
        'settings.shortcut.newtab': 'Open shortcuts in new tab',
        'settings.shortcut.newtab.desc': 'If enabled, shortcuts open in a new tab; otherwise, open in the current page',
        'settings.theme.default': 'Default Themes',
        'settings.theme.custom': 'Custom Theme',
        'settings.theme.gradient': 'Gradient',
        'settings.theme.save': 'Save Theme',
        'settings.theme.saved': 'Saved',
        'search.placeholder': 'Enter search terms...',
        'search.engines.google': 'Google',
        'search.engines.bing': 'Bing',
        'search.engines.baidu': 'Baidu',
        'search.engines.bingcn': 'BingCN',
        'search.engines.github': 'GitHub',
        'search.engines.zhihu': 'Zhihu',
        'search.engines.bilibili': 'Bilibili',
        'shortcut.add': 'Add Shortcut',
        'shortcut.add.title': 'Add Website Shortcut',
        'shortcut.add.url': 'URL',
        'shortcut.add.name': 'Title',
        'shortcut.add.auto': '- Auto-fetch if empty',
        'shortcut.add.cancel': 'Cancel',
        'shortcut.add.confirm': 'Add',
        'shortcut.reset.title': 'Confirm Reset',
        'shortcut.reset.message': 'Are you sure you want to reset all shortcuts? This will delete all custom shortcuts.',
        'shortcut.reset.cancel': 'Cancel',
        'shortcut.reset.confirm': 'Reset',
        'shortcut.delete.title': 'Confirm Delete',
        'shortcut.delete.message': 'Are you sure you want to delete this shortcut?',
        'shortcut.delete.cancel': 'Cancel',
        'shortcut.delete.confirm': 'Delete',
        'theme.pink': 'Pink',
        'theme.deep-ocean': 'Deep Ocean',
        'theme.forest': 'Forest',
        'theme.sunset': 'Sunset',
        'theme.neon': 'Neon',
        'theme.royal': 'Royal',
        'theme.desert': 'Desert',
        'theme.aurora': 'Aurora',
        'theme.cherry': 'Cherry',
        'theme.emerald': 'Emerald',
        'theme.dark-night': 'Dark Night',
        'theme.pure-white': 'Pure White',
        'theme.cyberpunk': 'Cyberpunk',
        'theme.pastel': 'Pastel',
        'theme.midnight': 'Midnight',
        'theme.lavender': 'Lavender',
        'theme.ocean': 'Ocean',
        'theme.autumn': 'Autumn',
        'theme.mint': 'Mint',
        'theme.galaxy': 'Galaxy',
        'theme.black-yellow': 'Black Gold',
        'theme.blue-yellow': 'Blue Gold',
        'theme.orange-red': 'Orange Red',
        'theme.black-blue': 'Black Blue',
        'theme.purple-gold': 'Purple Gold',
        'theme.emerald-gold': 'Emerald Gold',
        'theme.ruby-silver': 'Ruby Silver',
        'theme.jade-purple': 'Jade Purple',
        'theme.crimson-gold': 'Crimson Gold',
        'theme.azure-rose': 'Azure Rose',
        'shortcut.add.fetching': 'Fetching...',
        'shortcut.add.fetch_failed': 'Fetch failed',
        'login.title': 'Account Login',
        'login.tab.login': 'Login',
        'login.tab.register': 'Register',
        'login.tab.forgot': 'Forgot Password',
        'login.email.placeholder': 'Email',
        'login.password.placeholder': 'Password',
        'login.button': 'Login',
        'login.user.logout': 'Logout',
        'register.email.placeholder': 'Email',
        'register.password.placeholder': 'Password',
        'register.confirm.placeholder': 'Confirm Password',
        'register.button': 'Register',
        'forgot.email.placeholder': 'Email',
        'forgot.button': 'Reset Password',
        'login.message.success': 'Login successful',
        'login.message.error': 'Login failed',
        'register.message.success': 'Registration successful',
        'register.message.error': 'Registration failed',
        'forgot.message.success': 'Password reset email sent',
        'forgot.message.error': 'Password reset failed',
        'forgot.password.placeholder': 'New Password',
        'forgot.confirm.placeholder': 'Confirm New Password',
        'register.username.placeholder': 'Username',
        'login.status.not_logged_in': 'Not logged in'
    }
};

export class LanguageManager {
    constructor() {
        this.currentLang = localStorage.getItem('preferred_language') || 'zh-CN';
        this.translations = translations;
    }

    // 切换语言
    setLanguage(lang) {
        if (this.translations[lang]) {
            this.currentLang = lang;
            localStorage.setItem('preferred_language', lang);
            this.updatePageTranslations();
            // 确保在 DOM 更新后重新渲染主题网格
            requestAnimationFrame(() => {
                if (window.themeManager) {
                    window.themeManager.renderThemeGrid();
                }
            });

            // 更新本地用户设置中的语言
            if (window.userAPI && window.userAPI.isLoggedIn()) {
                const currentUser = window.userAPI.getCurrentUser();
                if (currentUser && currentUser.settings) {
                    // 只更新本地存储
                    currentUser.settings.language = lang;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    // 更新UI显示
                    if (window.userAPI.updateLoginState) {
                        window.userAPI.updateLoginState(true, currentUser);
                    }
                }
            }
        }
    }

    // 获取当前语言的翻译
    getTranslation(key) {
        return this.translations[this.currentLang][key] || key;
    }

    // 更新页面上所有需要翻译的元素
    updatePageTranslations() {
        const elements = document.querySelectorAll('[data-i18n]');
        elements.forEach(element => {
            const key = element.getAttribute('data-i18n');
            if (!key) return;

            //如果用户名是已经登录了，就不更新翻译
            if(key === 'login.status.not_logged_in' && window.userAPI.isLoggedIn()){
                return;
            }
            
            const translation = this.getTranslation(key);
            
            if (element.tagName === 'INPUT' && element.getAttribute('placeholder')) {
                element.placeholder = translation;
            } else {
                element.textContent = translation;
            }
        });
    }
} 